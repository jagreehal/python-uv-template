#!/bin/sh

# Get the current working directory
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
cd "$(dirname "$DIR")"

echo "Running pre-push checks..."

# Run format check
echo "\nğŸ” Running format check..."
make format

# Check if there are any unstaged changes after formatting
if ! git diff --quiet; then
    echo "âŒ Error: Code formatting resulted in changes."
    echo "Please stage and commit the following changes:"
    git diff --name-only
    exit 1
fi

# Run type check
echo "\nğŸ” Running type check..."
if ! make type-check; then
    echo "âŒ Error: Type check failed."
    echo "Please fix the type errors before pushing."
    exit 1
fi

# Run linter
echo "\nğŸ” Running linter..."
if ! make lint; then
    echo "âŒ Error: Linting failed."
    echo "Please fix the linting errors before pushing."
    exit 1
fi

# Run tests
echo "\nğŸ” Running tests..."
if ! make test; then
    echo "âŒ Error: Tests failed."
    echo "Please fix the failing tests before pushing."
    exit 1
fi

echo "\nâœ… All checks passed! Proceeding with push."
exit 0 